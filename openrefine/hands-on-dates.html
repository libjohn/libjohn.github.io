<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Cleaning Data with OpenRefine</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="This lab workbook contains hands-on material supplementing the OpenRefine workshops">
  <meta name="generator" content="bookdown 0.3.4 and GitBook 2.6.7">

  <meta property="og:title" content="Cleaning Data with OpenRefine" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This lab workbook contains hands-on material supplementing the OpenRefine workshops" />
  <meta name="github-repo" content="libjohn/openrefine" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Cleaning Data with OpenRefine" />
  
  <meta name="twitter:description" content="This lab workbook contains hands-on material supplementing the OpenRefine workshops" />
  

<meta name="author" content="John Little">


<meta name="date" content="2017-01-23">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="hands-on-reshape.html">


<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />










<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="" data-path="workshop-outline.html"><a href="workshop-outline.html"><i class="fa fa-check"></i>Workshop Outline</a><ul>
<li class="chapter" data-level="" data-path="workshop-outline.html"><a href="workshop-outline.html#workshop-structure"><i class="fa fa-check"></i>Workshop Structure</a><ul>
<li class="chapter" data-level="" data-path="workshop-outline.html"><a href="workshop-outline.html#testimonial"><i class="fa fa-check"></i>Testimonial</a></li>
<li class="chapter" data-level="" data-path="workshop-outline.html"><a href="workshop-outline.html#workshop-philosophy"><i class="fa fa-check"></i>Workshop Philosophy</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="workshop-outline.html"><a href="workshop-outline.html#workshop-video"><i class="fa fa-check"></i>Workshop Video</a></li>
<li class="chapter" data-level="" data-path="workshop-outline.html"><a href="workshop-outline.html#for-best-results"><i class="fa fa-check"></i>For best results</a></li>
<li class="chapter" data-level="" data-path="workshop-outline.html"><a href="workshop-outline.html#overview"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="" data-path="workshop-outline.html"><a href="workshop-outline.html#comparative-advantage"><i class="fa fa-check"></i>Comparative Advantage</a></li>
<li class="chapter" data-level="" data-path="workshop-outline.html"><a href="workshop-outline.html#characteristics"><i class="fa fa-check"></i>Characteristics</a><ul>
<li class="chapter" data-level="" data-path="workshop-outline.html"><a href="workshop-outline.html#general"><i class="fa fa-check"></i>General</a></li>
<li class="chapter" data-level="" data-path="workshop-outline.html"><a href="workshop-outline.html#video"><i class="fa fa-check"></i>Video</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="demonstration.html"><a href="demonstration.html"><i class="fa fa-check"></i>Demonstration</a><ul>
<li class="chapter" data-level="" data-path="demonstration.html"><a href="demonstration.html#navigating-the-project"><i class="fa fa-check"></i>Navigating the “Project”</a></li>
<li class="chapter" data-level="" data-path="demonstration.html"><a href="demonstration.html#facets"><i class="fa fa-check"></i>Facets</a></li>
<li class="chapter" data-level="" data-path="demonstration.html"><a href="demonstration.html#rows-vs.records"><i class="fa fa-check"></i>Rows vs. Records</a></li>
<li class="chapter" data-level="" data-path="demonstration.html"><a href="demonstration.html#web-scrape-api"><i class="fa fa-check"></i>Web Scrape &amp; API</a></li>
<li class="chapter" data-level="" data-path="demonstration.html"><a href="demonstration.html#parsing-data"><i class="fa fa-check"></i>Parsing Data</a></li>
<li class="chapter" data-level="" data-path="demonstration.html"><a href="demonstration.html#split"><i class="fa fa-check"></i>Split</a></li>
<li class="chapter" data-level="" data-path="demonstration.html"><a href="demonstration.html#concatenate"><i class="fa fa-check"></i>Concatenate</a></li>
<li class="chapter" data-level="" data-path="demonstration.html"><a href="demonstration.html#find-replace"><i class="fa fa-check"></i>Find &amp; Replace</a></li>
<li class="chapter" data-level="" data-path="demonstration.html"><a href="demonstration.html#facet-by-blank"><i class="fa fa-check"></i>Facet by Blank</a></li>
<li class="chapter" data-level="" data-path="demonstration.html"><a href="demonstration.html#custom-facet"><i class="fa fa-check"></i>Custom Facet</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="start.html"><a href="start.html"><i class="fa fa-check"></i><b>1</b> Hands-on: basic transformations</a><ul>
<li class="chapter" data-level="1.1" data-path="start.html"><a href="start.html#getting-started"><i class="fa fa-check"></i><b>1.1</b> Getting Started</a></li>
<li class="chapter" data-level="1.2" data-path="start.html"><a href="start.html#shutting-down-openrefine"><i class="fa fa-check"></i><b>1.2</b> Shutting Down OpenRefine</a></li>
<li class="chapter" data-level="1.3" data-path="start.html"><a href="start.html#facets-cluster"><i class="fa fa-check"></i><b>1.3</b> Facets &amp; Cluster</a><ul>
<li class="chapter" data-level="" data-path="start.html"><a href="start.html#handson-facets"><i class="fa fa-check"></i>Facet &amp; Cluster</a></li>
<li class="chapter" data-level="" data-path="start.html"><a href="start.html#compound-facets"><i class="fa fa-check"></i>Compound Facets</a></li>
<li class="chapter" data-level="" data-path="start.html"><a href="start.html#mass-edit"><i class="fa fa-check"></i>Mass Editing</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="start.html"><a href="start.html#split-data-in-cells"><i class="fa fa-check"></i><b>1.4</b> Split data in cells</a></li>
<li class="chapter" data-level="1.5" data-path="start.html"><a href="start.html#concatenate-cells-together"><i class="fa fa-check"></i><b>1.5</b> Concatenate cells together</a></li>
<li class="chapter" data-level="1.6" data-path="start.html"><a href="start.html#more-transformations"><i class="fa fa-check"></i><b>1.6</b> More Transformations</a><ul>
<li class="chapter" data-level="" data-path="start.html"><a href="start.html#data-types"><i class="fa fa-check"></i>Data Types</a></li>
<li class="chapter" data-level="" data-path="start.html"><a href="start.html#whitespace"><i class="fa fa-check"></i>Whitespace</a></li>
<li class="chapter" data-level="" data-path="start.html"><a href="start.html#search-replace"><i class="fa fa-check"></i>Search &amp; Replace</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="start.html"><a href="start.html#web-scraping"><i class="fa fa-check"></i><b>1.7</b> Web Scraping</a><ul>
<li class="chapter" data-level="" data-path="start.html"><a href="start.html#subset"><i class="fa fa-check"></i>Select a subset</a></li>
<li class="chapter" data-level="" data-path="start.html"><a href="start.html#api"><i class="fa fa-check"></i>API</a></li>
<li class="chapter" data-level="" data-path="start.html"><a href="start.html#parse"><i class="fa fa-check"></i>Parse</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="grel.html"><a href="grel.html"><i class="fa fa-check"></i><b>2</b> Hands-on: GREL</a><ul>
<li class="chapter" data-level="2.1" data-path="grel.html"><a href="grel.html#custom-facets"><i class="fa fa-check"></i><b>2.1</b> Custom Facets</a><ul>
<li class="chapter" data-level="" data-path="grel.html"><a href="grel.html#grel-compound"><i class="fa fa-check"></i>Download new Data then Create a new OpenRefine Project:</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="grel.html"><a href="grel.html#grel-to-transform-and-normalize"><i class="fa fa-check"></i><b>2.2</b> GREL to Transform and Normalize</a><ul>
<li class="chapter" data-level="" data-path="grel.html"><a href="grel.html#regular-expression"><i class="fa fa-check"></i>Regular Expression</a></li>
<li class="chapter" data-level="" data-path="grel.html"><a href="grel.html#filter"><i class="fa fa-check"></i>Filter</a></li>
<li class="chapter" data-level="" data-path="grel.html"><a href="grel.html#facet"><i class="fa fa-check"></i>Facet</a></li>
<li class="chapter" data-level="" data-path="grel.html"><a href="grel.html#cluster"><i class="fa fa-check"></i>Cluster</a></li>
<li class="chapter" data-level="" data-path="grel.html"><a href="grel.html#mass-editing"><i class="fa fa-check"></i>Mass Editing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="hands-on-reshape.html"><a href="hands-on-reshape.html"><i class="fa fa-check"></i><b>3</b> Hands-on: reshape</a><ul>
<li class="chapter" data-level="3.1" data-path="hands-on-reshape.html"><a href="hands-on-reshape.html#ingest-excel-data"><i class="fa fa-check"></i><b>3.1</b> Ingest Excel data</a></li>
<li class="chapter" data-level="3.2" data-path="hands-on-reshape.html"><a href="hands-on-reshape.html#facets-1"><i class="fa fa-check"></i><b>3.2</b> Facets</a></li>
<li class="chapter" data-level="3.3" data-path="hands-on-reshape.html"><a href="hands-on-reshape.html#text-filter"><i class="fa fa-check"></i><b>3.3</b> Text Filter</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="hands-on-dates.html"><a href="hands-on-dates.html"><i class="fa fa-check"></i><b>4</b> Hands-on: dates</a><ul>
<li class="chapter" data-level="4.1" data-path="hands-on-dates.html"><a href="hands-on-dates.html#dates"><i class="fa fa-check"></i><b>4.1</b> Dates</a></li>
<li class="chapter" data-level="4.2" data-path="hands-on-dates.html"><a href="hands-on-dates.html#logic"><i class="fa fa-check"></i><b>4.2</b> Logic</a></li>
<li class="chapter" data-level="4.3" data-path="hands-on-dates.html"><a href="hands-on-dates.html#reproducible"><i class="fa fa-check"></i><b>4.3</b> Reproducible</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span><ul>
<li class="chapter" data-level="" data-path=""><a href="#hands-on-answers"><i class="fa fa-check"></i>Hands-on Answers</a><ul>
<li class="chapter" data-level="" data-path="hands-on-dates.html"><a href="hands-on-dates.html#appendix-facets"><i class="fa fa-check"></i>facets</a></li>
<li class="chapter" data-level="" data-path="hands-on-dates.html"><a href="hands-on-dates.html#appendix-compound"><i class="fa fa-check"></i>compound facets</a></li>
<li class="chapter" data-level="" data-path="hands-on-dates.html"><a href="hands-on-dates.html#appendix-mass-edit"><i class="fa fa-check"></i>mass edit cells</a></li>
<li class="chapter" data-level="" data-path="hands-on-dates.html"><a href="hands-on-dates.html#appendix-grel"><i class="fa fa-check"></i>GREL: Custom Facets, filter, cluster and edit, mass edit</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="hands-on-dates.html"><a href="hands-on-dates.html#additional-documentation"><i class="fa fa-check"></i>Additional Documentation</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Cleaning Data with OpenRefine</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="hands-on-dates" class="section level1">
<h1><span class="header-section-number">4</span> Hands-on: dates</h1>
<p>Dates are weird!<a href="#fn11" class="footnoteRef" id="fnref11"><sup>11</sup></a> Or, more accurately, <a href="http://www.newyorker.com/magazine/2016/12/19/the-secret-life-of-time">Time</a> is philosophically fascinating and sometimes difficult to represent. This is true for your brain and it’s especially true for your computer. Keep in mind that converting dates (i.e. using the <code>toDate()</code> function) format sometimes results in errors because time and date formats are weird.</p>
<p>Often, in OpenRefine, it’s easiest to operate on strings and convert to dates (or to numbers) as needed. For example, sometimes it’s easier to use a <code>slice()</code> of a string and then convert to date, or to number if you really need to do so.</p>
<p>However, in OpenRefine, the date format is necessary for date faceting and for finding the difference between two dates (e.g. using the <code>diff()</code> function, or for getting a <code>datePart()</code> for retrieving an hour, or second).</p>
<p>This project will give you practice manipulating dates</p>
<div id="dates" class="section level2">
<h2><span class="header-section-number">4.1</span> Dates</h2>
<ol style="list-style-type: decimal">
<li>Open the existing Refine Project from Project 1 - <code>Raleigh Building Permits</code><br />
</li>
<li>Make a copy of the issue_date column
<ul>
<li><span class="or-menu">issue_date &gt; Edit column &gt; Add column based on this column… </span>
<ul>
<li><span class="or-menu">new column name = <code>date2</code> &gt; OK </span><br />
</li>
</ul></li>
</ul></li>
<li>Create a customized facet on AM/PM
<ul>
<li><span class="or-menu">issue_date &gt; Facet &gt; Custom text facet … </span>
<ul>
<li>Expression = <code>value.slice(20,22)</code><br />
</li>
</ul></li>
</ul></li>
<li>Create a customized facet on the hour
<ul>
<li><span class="or-menu">issue_date &gt; Facet &gt; Custom text facet… </span>
<ul>
<li>Expression = <code>value.slice(10,13)</code><br />
</li>
</ul></li>
</ul></li>
<li>Convert to Date
<ul>
<li><span class="or-menu">date2 &gt; Edit cells &gt; Common transforms &gt; To Date </span></li>
</ul>
<blockquote>
<p>The status message indicates 19598 rows were transformed, but there are 21982 rows of data, what went wrong?</p>
</blockquote>
<ul>
<li>Select the “PM” custom text facet and the “12” custom text facet
<ul>
<li>Do you see that none of the dates converted when the time included 12PM?<br />
</li>
<li>For whatever reason, the date converter doesn’t like timestamps that contain 12PM as a designation<br />
</li>
<li>So let’s convert those dates from 12PM to 00PM (Why? because it fixes the problem)<br />
</li>
</ul></li>
</ul></li>
<li>Convert 12PM to 00PM
<ul>
<li><span class="or-menu">date2 Edit cells &gt; transform </span>
<ul>
<li>Expression = <code>value.replace(&quot; 12:&quot;,&quot; 00:&quot;)</code></li>
</ul></li>
</ul></li>
<li>Now convert to date
<ul>
<li><span class="or-menu">date2 &gt; Edit cells &gt; Common transforms &gt; To Date </span></li>
</ul>
<blockquote>
<p>That converts 2384 cells</p>
</blockquote></li>
<li>Now make a date facet
<ul>
<li><span class="or-menu">date2 &gt; Facet &gt; Timeline facet </span></li>
</ul></li>
</ol>
</div>
<div id="logic" class="section level2">
<h2><span class="header-section-number">4.2</span> Logic</h2>
<p>This time we’ll put together everything we’ve learned (how to use OpenRefine, regular expressions, GREL) and add in some <strong>IF</strong> logic. You will see in this example that OpenRefine is a powerful data transformation tool that can easily support a lot of casual attention to syntax, file handling, and looping. But OpenRefine is also a powerful and extensible tool that supports scripting that begins to look like programming.</p>
<p><strong>Goal</strong>: Make the same data transformations as in the previous slide’s steps 2-7, but this time you’ll do it in one step. Think about how GREL allows you to take shortcuts.</p>
<ol style="list-style-type: decimal">
<li>First, Remove All facets, then…
<ul>
<li><span class="or-menu">issue_date &gt; Edit Column &gt; Add column based on this column… </span></li>
<li>New Column Name = <code>date3</code><br />
</li>
<li>Expression = <code>if(value.slice(20,22) == &quot;PM&quot;, value.replace(/(.*\s)12(:\d\d:.*)/,&quot;$100$2&quot;), value).toDate()</code><br />
</li>
</ul></li>
<li>Now make a date facet
<ul>
<li><span class="or-menu">date3 &gt; Facet &gt; Timeline facet </span></li>
</ul></li>
</ol>
</div>
<div id="reproducible" class="section level2">
<h2><span class="header-section-number">4.3</span> Reproducible</h2>
<p>Refine supports reproducible research. Here are the things you may have already noticed.</p>
<ul>
<li>Undo: every step is recorded and can be undone.</li>
<li>Share: your steps are recorded and can be shared in a JSON notation</li>
<li>projects: In each OpenRefine “project”, all the steps of your project are recorded and are shareable.</li>
<li>Exporting: There is a powerful export mechanism that allows you to build selective reports</li>
</ul>

</div>
</div>



<h2>Hands-on Answers</h2>
<div id="appendix-facets" class="section level3 unnumbered">
<h3>facets</h3>
<ul>
<li><ol style="list-style-type: decimal">
<li>21,982 rows (<a href="start.html#handson-facets">return</a>)<br />
</li>
</ol></li>
<li><ol start="3" style="list-style-type: decimal">
<li>7633 choices</li>
</ol></li>
<li><ol start="4" style="list-style-type: decimal">
<li>SCREEN PORCH ; 233</li>
</ol></li>
<li><ol start="8" style="list-style-type: decimal">
<li>238</li>
</ol></li>
</ul>
</div>
<div id="appendix-compound" class="section level3 unnumbered">
<h3>compound facets</h3>
<ul>
<li><ol style="list-style-type: decimal">
<li>340 (<a href="start.html#compound-facets">return</a>)</li>
</ol></li>
<li><ol start="2" style="list-style-type: decimal">
<li>578</li>
</ol></li>
<li><ol start="4" style="list-style-type: decimal">
<li>3; both</li>
</ol></li>
<li><ol start="5" style="list-style-type: decimal">
<li>21,982</li>
</ol></li>
</ul>
</div>
<div id="appendix-mass-edit" class="section level3 unnumbered">
<h3>mass edit cells</h3>
<ul>
<li><ol start="2" style="list-style-type: decimal">
<li>3 ; 9668 (<a href="start.html#mass-edit">return</a>)</li>
</ol></li>
<li><ol start="3" style="list-style-type: decimal">
<li>9671</li>
</ol></li>
</ul>
</div>
<div id="appendix-grel" class="section level3 unnumbered">
<h3>GREL: Custom Facets, filter, cluster and edit, mass edit</h3>
<ul>
<li><ol start="2" style="list-style-type: decimal">
<li>How many matching rows have no location data? 10576 (<a href="grel.html#grel-compound">return</a>)<br />
</li>
</ol></li>
<li><ol start="4" style="list-style-type: decimal">
<li>2005 has the most missing data with 10007 rows missing location data<br />
</li>
</ol></li>
<li><ol start="8" style="list-style-type: decimal">
<li>251 matching rows<br />
</li>
</ol></li>
<li><ol start="10" style="list-style-type: decimal">
<li>There are 234 “Not Felony” items after clustering using both “key collision” and “nearest neighbor” methods of clustering</li>
</ol></li>
<li><ol start="12" style="list-style-type: decimal">
<li>There are 115 observatins (or rows) matching “LARCENY/BICYCLES ($200-$1,000)” category</li>
</ol></li>
</ul>
</div>
</div>
<div id="additional-documentation" class="section level2 unnumbered">
<h2>Additional Documentation</h2>
<ul>
<li><a href="http://openrefine.org/documentation.html">Documentaion, “The Book”, and Mailing List</a></li>
</ul>

</div>
</div>
















<div class="footnotes">
<hr />
<ol start="11">
<li id="fn11"><p><a href="http://www.i-programmer.info/babbages-bag/391-dates-are-difficult.html">Dates are Difficult</a> by Mike James (www.i-programmer.info)<a href="hands-on-dates.html#fnref11">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="hands-on-reshape.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>


<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
