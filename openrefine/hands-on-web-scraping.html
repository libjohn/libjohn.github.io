<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Cleaning Data with OpenRefine</title>
  <meta name="description" content="This lab workbook contains hands-on material supplementing the OpenRefine workshops">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Cleaning Data with OpenRefine" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This lab workbook contains hands-on material supplementing the OpenRefine workshops" />
  <meta name="github-repo" content="libjohn/openrefine" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Cleaning Data with OpenRefine" />
  
  <meta name="twitter:description" content="This lab workbook contains hands-on material supplementing the OpenRefine workshops" />
  

<meta name="author" content="John Little">


<meta name="date" content="2018-04-30">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="hands-on-reconciliation.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />










<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="" data-path="workshop-outline.html"><a href="workshop-outline.html"><i class="fa fa-check"></i>Workshop Outline</a><ul>
<li class="chapter" data-level="" data-path="workshop-outline.html"><a href="workshop-outline.html#workshop-structure"><i class="fa fa-check"></i>Workshop Structure</a><ul>
<li class="chapter" data-level="" data-path="workshop-outline.html"><a href="workshop-outline.html#testimonial"><i class="fa fa-check"></i>Testimonial</a></li>
<li class="chapter" data-level="" data-path="workshop-outline.html"><a href="workshop-outline.html#workshop-philosophy"><i class="fa fa-check"></i>Workshop Philosophy</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="workshop-outline.html"><a href="workshop-outline.html#workshop-video"><i class="fa fa-check"></i>Workshop Video</a></li>
<li class="chapter" data-level="" data-path="workshop-outline.html"><a href="workshop-outline.html#for-best-results"><i class="fa fa-check"></i>For best results</a></li>
<li class="chapter" data-level="" data-path="workshop-outline.html"><a href="workshop-outline.html#overview"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="" data-path="workshop-outline.html"><a href="workshop-outline.html#comparative-advantage"><i class="fa fa-check"></i>Comparative Advantage</a></li>
<li class="chapter" data-level="" data-path="workshop-outline.html"><a href="workshop-outline.html#characteristics"><i class="fa fa-check"></i>Characteristics</a><ul>
<li class="chapter" data-level="" data-path="workshop-outline.html"><a href="workshop-outline.html#general"><i class="fa fa-check"></i>General</a></li>
<li class="chapter" data-level="" data-path="workshop-outline.html"><a href="workshop-outline.html#video"><i class="fa fa-check"></i>Video</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="demonstration.html"><a href="demonstration.html"><i class="fa fa-check"></i>Demonstration</a><ul>
<li class="chapter" data-level="" data-path="demonstration.html"><a href="demonstration.html#load-data"><i class="fa fa-check"></i>Load Data</a></li>
<li class="chapter" data-level="" data-path="demonstration.html"><a href="demonstration.html#navigating-the-project"><i class="fa fa-check"></i>Navigating the “Project”</a></li>
<li class="chapter" data-level="" data-path="demonstration.html"><a href="demonstration.html#facets"><i class="fa fa-check"></i>Facets</a></li>
<li class="chapter" data-level="" data-path="demonstration.html"><a href="demonstration.html#rows-vs.records"><i class="fa fa-check"></i>Rows vs. Records</a></li>
<li class="chapter" data-level="" data-path="demonstration.html"><a href="demonstration.html#web-scrape-api"><i class="fa fa-check"></i>Web Scrape &amp; API</a></li>
<li class="chapter" data-level="" data-path="demonstration.html"><a href="demonstration.html#parsing-data"><i class="fa fa-check"></i>Parsing Data</a></li>
<li class="chapter" data-level="" data-path="demonstration.html"><a href="demonstration.html#split"><i class="fa fa-check"></i>Split</a></li>
<li class="chapter" data-level="" data-path="demonstration.html"><a href="demonstration.html#concatenate"><i class="fa fa-check"></i>Concatenate</a></li>
<li class="chapter" data-level="" data-path="demonstration.html"><a href="demonstration.html#find-replace"><i class="fa fa-check"></i>Find &amp; Replace</a></li>
<li class="chapter" data-level="" data-path="demonstration.html"><a href="demonstration.html#facet-by-blank"><i class="fa fa-check"></i>Facet by Blank</a></li>
<li class="chapter" data-level="" data-path="demonstration.html"><a href="demonstration.html#text-filter"><i class="fa fa-check"></i>Text filter</a></li>
<li class="chapter" data-level="" data-path="demonstration.html"><a href="demonstration.html#custom-facet"><i class="fa fa-check"></i>Custom Facet</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="start.html"><a href="start.html"><i class="fa fa-check"></i><b>1</b> Hands-on: basic transformations</a><ul>
<li class="chapter" data-level="1.1" data-path="start.html"><a href="start.html#getting-started"><i class="fa fa-check"></i><b>1.1</b> Getting Started</a></li>
<li class="chapter" data-level="1.2" data-path="start.html"><a href="start.html#shutting-down-openrefine"><i class="fa fa-check"></i><b>1.2</b> Shutting Down OpenRefine</a></li>
<li class="chapter" data-level="1.3" data-path="start.html"><a href="start.html#facets-cluster"><i class="fa fa-check"></i><b>1.3</b> Facets &amp; Cluster</a><ul>
<li class="chapter" data-level="" data-path="start.html"><a href="start.html#facet-cluster"><i class="fa fa-check"></i>Facet &amp; Cluster</a></li>
<li class="chapter" data-level="" data-path="start.html"><a href="start.html#compound-facets"><i class="fa fa-check"></i>Compound Facets</a></li>
<li class="chapter" data-level="" data-path="start.html"><a href="start.html#mass-editing"><i class="fa fa-check"></i>Mass Editing</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="start.html"><a href="start.html#split-data-in-cells"><i class="fa fa-check"></i><b>1.4</b> Split data in cells</a></li>
<li class="chapter" data-level="1.5" data-path="start.html"><a href="start.html#concatenate-cells-together"><i class="fa fa-check"></i><b>1.5</b> Concatenate cells together</a></li>
<li class="chapter" data-level="1.6" data-path="start.html"><a href="start.html#search-replace-plus-more"><i class="fa fa-check"></i><b>1.6</b> Search &amp; Replace, Plus More</a><ul>
<li class="chapter" data-level="" data-path="start.html"><a href="start.html#convert-data-types"><i class="fa fa-check"></i>Convert Data Types</a></li>
<li class="chapter" data-level="" data-path="start.html"><a href="start.html#remove-whitespace"><i class="fa fa-check"></i>Remove Whitespace</a></li>
<li class="chapter" data-level="" data-path="start.html"><a href="start.html#search-replace"><i class="fa fa-check"></i>Search &amp; Replace</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="start.html"><a href="start.html#web-scraping"><i class="fa fa-check"></i><b>1.7</b> Web Scraping</a><ul>
<li class="chapter" data-level="" data-path="start.html"><a href="start.html#subset"><i class="fa fa-check"></i>Select a subset</a></li>
<li class="chapter" data-level="" data-path="start.html"><a href="start.html#api"><i class="fa fa-check"></i>API</a></li>
<li class="chapter" data-level="" data-path="start.html"><a href="start.html#parse"><i class="fa fa-check"></i>Parse</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="grel.html"><a href="grel.html"><i class="fa fa-check"></i><b>2</b> Hands-on: GREL</a><ul>
<li class="chapter" data-level="2.1" data-path="grel.html"><a href="grel.html#custom-facets"><i class="fa fa-check"></i><b>2.1</b> Custom Facets</a><ul>
<li class="chapter" data-level="" data-path="grel.html"><a href="grel.html#download-new-data-then-create-a-new-openrefine-project"><i class="fa fa-check"></i>Download new Data then Create a new OpenRefine Project:</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="grel.html"><a href="grel.html#grel-to-transform-and-normalize"><i class="fa fa-check"></i><b>2.2</b> GREL to Transform and Normalize</a></li>
<li class="chapter" data-level="" data-path="grel.html"><a href="grel.html#regular-expression"><i class="fa fa-check"></i>Regular Expression</a></li>
<li class="chapter" data-level="" data-path="grel.html"><a href="grel.html#filter-text"><i class="fa fa-check"></i>Filter Text</a></li>
<li class="chapter" data-level="" data-path="grel.html"><a href="grel.html#facet"><i class="fa fa-check"></i>Facet</a></li>
<li class="chapter" data-level="" data-path="grel.html"><a href="grel.html#cluster"><i class="fa fa-check"></i>Cluster</a></li>
<li class="chapter" data-level="" data-path="grel.html"><a href="grel.html#mass-editing-via-facets"><i class="fa fa-check"></i>Mass Editing via Facets</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="hands-on-reshape.html"><a href="hands-on-reshape.html"><i class="fa fa-check"></i><b>3</b> Hands-on: reshape</a><ul>
<li class="chapter" data-level="3.1" data-path="hands-on-reshape.html"><a href="hands-on-reshape.html#ingest-excel-data"><i class="fa fa-check"></i><b>3.1</b> Ingest Excel data</a></li>
<li class="chapter" data-level="3.2" data-path="hands-on-reshape.html"><a href="hands-on-reshape.html#facets-1"><i class="fa fa-check"></i><b>3.2</b> Facets</a></li>
<li class="chapter" data-level="3.3" data-path="hands-on-reshape.html"><a href="hands-on-reshape.html#text-filter-1"><i class="fa fa-check"></i><b>3.3</b> Text Filter</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="hands-on-dates.html"><a href="hands-on-dates.html"><i class="fa fa-check"></i><b>4</b> Hands-on: dates</a><ul>
<li class="chapter" data-level="4.1" data-path="hands-on-dates.html"><a href="hands-on-dates.html#dates"><i class="fa fa-check"></i><b>4.1</b> Dates</a></li>
<li class="chapter" data-level="4.2" data-path="hands-on-dates.html"><a href="hands-on-dates.html#logic"><i class="fa fa-check"></i><b>4.2</b> Logic</a></li>
<li class="chapter" data-level="4.3" data-path="hands-on-dates.html"><a href="hands-on-dates.html#reproducible"><i class="fa fa-check"></i><b>4.3</b> Reproducible</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="hands-on-reconciliation.html"><a href="hands-on-reconciliation.html"><i class="fa fa-check"></i><b>5</b> Hands-on: Reconciliation</a><ul>
<li class="chapter" data-level="5.1" data-path="hands-on-reconciliation.html"><a href="hands-on-reconciliation.html#reconciliation"><i class="fa fa-check"></i><b>5.1</b> Reconciliation</a></li>
<li class="chapter" data-level="5.2" data-path="hands-on-reconciliation.html"><a href="hands-on-reconciliation.html#reconciliation-resources"><i class="fa fa-check"></i><b>5.2</b> Reconciliation Resources</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="hands-on-web-scraping.html"><a href="hands-on-web-scraping.html"><i class="fa fa-check"></i><b>6</b> Hands-on: Web Scraping</a><ul>
<li class="chapter" data-level="6.1" data-path="hands-on-web-scraping.html"><a href="hands-on-web-scraping.html#api-1"><i class="fa fa-check"></i><b>6.1</b> API</a></li>
<li class="chapter" data-level="6.2" data-path="hands-on-web-scraping.html"><a href="hands-on-web-scraping.html#parse-1"><i class="fa fa-check"></i><b>6.2</b> Parse</a></li>
<li class="chapter" data-level="6.3" data-path="hands-on-web-scraping.html"><a href="hands-on-web-scraping.html#keys"><i class="fa fa-check"></i><b>6.3</b> Keys</a></li>
<li class="chapter" data-level="6.4" data-path="hands-on-web-scraping.html"><a href="hands-on-web-scraping.html#exercise-2"><i class="fa fa-check"></i><b>6.4</b> Exercise 2</a><ul>
<li class="chapter" data-level="" data-path="hands-on-web-scraping.html"><a href="hands-on-web-scraping.html#parse-2"><i class="fa fa-check"></i>Parse</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span><ul>
<li class="chapter" data-level="" data-path=""><a href="#additional-documentation"><i class="fa fa-check"></i>Additional Documentation</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Cleaning Data with OpenRefine</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="hands-on-web-scraping" class="section level1">
<h1><span class="header-section-number">6</span> Hands-on: Web Scraping</h1>
<p>Goal: We want to gather the FIPS code for some data by matching a county name to a government server which maintains a server that enables FIPS lookups. The government server returns data in a JSON format. After gathering the data we’ll parse the JSON format and isolate the particular data from the data wrapper.</p>
<ol style="list-style-type: decimal">
<li>Open Data
<ul>
<li><span class="or-menu">Create Project &gt; Web Addresses (URLs) &gt;</span> <code>https://raw.githubusercontent.com/libjohn/openrefine/master/data/subset-Raleigh-Building-Permits-for-API-JSON-parsing.csv</code><br />
</li>
<li><span class="or-menu">Next &gt;&gt;</span><br />
</li>
<li>You many want to give your project a pretty title</li>
<li>Create Project &gt;&gt;</li>
</ul></li>
</ol>
<p>You should now have 6 matching rows.</p>
<div id="api-1" class="section level2">
<h2><span class="header-section-number">6.1</span> API</h2>
<p>Now let’s fetch the data from a <a href="http://www.broadbandmap.gov/developer/">Web API</a> made available via the National Broadband Map (<a href="http://www.broadbandmap.gov/">NBM</a> | <a href="https://www.broadbandmap.gov/developer">NBM Developer</a>). This API returns a FIPS code, given a county name (or in this case, even a partial county name.)</p>
<ol start="2" style="list-style-type: decimal">
<li>Fetch JSON data from the National Broadband Map. We’ll use the <a href="http://www.broadbandmap.gov/developer/api/census-api-by-geography-name">API documentation for Geography by Name API</a><a href="#fn14" class="footnoteRef" id="fnref14"><sup>14</sup></a> which returns Census geography for a geography name (e.g. Durham). In this case we simply use the County <code>value</code> as the search string wrapped in the API query protocol.
<ul>
<li><span class="or-menu"> county &gt; Edit column &gt; Add column by fetching URLs… </span></li>
<li>New column name = <code>JSON data</code></li>
<li>Throttle delay = <code>2000</code></li>
<li>Expression = <br> <code>'https://www.broadbandmap.gov/broadbandmap/census/county/'+value+'?format=json'</code></li>
<li><span class="or-menu">OK</span></li>
</ul></li>
</ol>
</div>
<div id="parse-1" class="section level2">
<h2><span class="header-section-number">6.2</span> Parse</h2>
<p>Now parse the value of the JSON data “fips” element; call the “<span class="highlight-yellow-fixed">fips</span>” key when traversing the “<span class="highlight-turq-fixed">county</span>” objects from the <span class="highlight-green-fixed">Results</span> set.</p>
<ol start="3" style="list-style-type: decimal">
<li><span class="or-menu"> JSON data &gt; Edit column &gt; Add column based on this column … </span>
<ul>
<li>New column name = <code>FIPS Code</code><br />
</li>
<li>expression = <code>value.parseJson().Results.county[0].fips</code> <a href="#fn15" class="footnoteRef" id="fnref15"><sup>15</sup></a></li>
<li><span class="or-menu">OK</span></li>
</ul></li>
</ol>
<div class="video">
<iframe width="560" height="315" src="https://www.youtube.com/embed/DbjpmVEpMiI" frameborder="0" allowfullscreen>
</iframe>
<div class="video">

<div id="json-data-example-1" class="section level4 unnumbered">
<h4>JSON Data Example</h4>
<p>JSON <a href="#fn16" class="footnoteRef" id="fnref16"><sup>16</sup></a> is JavaScript Object Notation a data wrapper. The API, in this case, returns the data in a JSON format.</p>
<pre>
{
  "status": "OK",  
  "responseTime": 14,  
  "message": [  ],  
  "<span class="highlight-green-fixed">Results</span>": {  
    "<span class="highlight-turq-fixed">county</span>": [  
      {  
        "geographyType": "COUNTY2010",  
        "stateFips": "37",  
        "<span class="highlight-yellow-fixed">fips</span>": "37063",  
        "name": "Durham"  
      }  
    ]  
  }  
}  
</pre>
</div>
</div>
<div id="keys" class="section level2">
<h2><span class="header-section-number">6.3</span> Keys</h2>
<p>Web API keys are typically issued by the API service to help identify the origin of the API request. Contrary to the above example, most API services require keys. In this next example you’ll practice getting and using a key. In this case the key is free. They are not always free.</p>
<ol start="4" style="list-style-type: decimal">
<li>Go to the <a href="http://www.omdbapi.com/apikey.aspx">OMDB API key request page</a>. Enter your email and choose the <strong>free key</strong> option.</li>
<li>Check your email for your key. You’ll use this key appended to your search query. The documentation for this API can found at their <a href="http://www.omdbapi.com/">Parameters</a> section. It’s also helpful to have a look at the <strong>Examples</strong> section.</li>
</ol>
</div>
<div id="exercise-2" class="section level2">
<h2><span class="header-section-number">6.4</span> Exercise 2</h2>
<p>You’ll need your API key from the preceding steps.</p>
<ol start="6" style="list-style-type: decimal">
<li>Create a new project in OpenRefine</li>
<li>Click the <code>Clipboard</code> option, under <em>Get data from</em> and paste in the following:</li>
</ol>
<pre><code>The Warriors
Rocky
Bambi</code></pre>
<ol start="8" style="list-style-type: decimal">
<li>Give your project a nice name (e.g. “Movies”) and <span class="or-menu">Create Project &gt;&gt;</span></li>
<li><p>Fetch JSON data from the OMDB API</p>
<ul>
<li><span class="or-menu"> Column 1 &gt; Edit column &gt; Add column by fetching URLs… </span></li>
<li>New column name = <code>JSON data</code></li>
<li>Throttle delay = <code>2000</code></li>
<li>Expression = <br><code>'http://www.omdbapi.com/?t=' + escape(value, &quot;url&quot;) + '&amp;' + 'apikey=Yogi-and-BOO-BOO-BOY'</code></li>
<li>Be sure to substitute your actual api key (see above) for <code>Yogi-and-BOO-BOO-BOY</code></li>
<li><span class="or-menu">OK</span></li>
</ul></li>
</ol>
<div id="parse-2" class="section level3 unnumbered">
<h3>Parse</h3>
<ol start="10" style="list-style-type: decimal">
<li><p><span class="or-menu"> JSON data &gt; Edit column &gt; Add column based on this column … </span></p>
<ul>
<li>New column name = <code>Year</code><br />
</li>
<li>expression = <code>value.parseJson().Year</code></li>
<li><span class="or-menu">OK</span></li>
</ul></li>
<li><p><span class="or-menu"> JSON data &gt; Edit column &gt; Add column based on this column … </span></p>
<ul>
<li>New column name = <code>Poster</code><br />
</li>
<li>expression = <code>value.parseJson().Poster</code></li>
<li><span class="or-menu">OK</span></li>
</ul></li>
</ol>

</div>
</div>
</div>



<h2>Additional Documentation</h2>
<ul>
<li><a href="http://openrefine.org/documentation.html">Documentaion, “The Book”, and Mailing List</a></li>
</ul>

</div>
</div>





















<div class="footnotes">
<hr />
<ol start="14">
<li id="fn14"><p>The documentation informs us that the format of the URL we want to construct is as follows: <a href="http://www.broadbandmap.gov/broadbandmap/census/county/durh?format=json" class="uri">http://www.broadbandmap.gov/broadbandmap/census/county/durh?format=json</a><a href="hands-on-web-scraping.html#fnref14">↩</a></p></li>
<li id="fn15"><p>Note the square-bracket (<code>[0]</code>) notation in the <code>ParseJson()</code> function denotes and identifies the first array element. It’s the first element because in OpenRefine counting begins with zero (e.g. 0,1,2,3,4,5). The <span class="highlight-turq-fixed">county</span> array in the example below consists of only 1 value element (consisting of four, named key/value pairs; of which fips is one key). Since the JSON notation indicates county is an array, in this case of quantity 1, we identify that first element of the array by the number ‘0’. See the JSON example below<a href="hands-on-web-scraping.html#fnref15">↩</a></p></li>
<li id="fn16"><p><a href="https://en.wikipedia.org/wiki/JSON">Wikipedia entry for JSON</a><a href="hands-on-web-scraping.html#fnref16">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="hands-on-reconciliation.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
